# 设备状态更新失败，原来是这个坑导致的

<!--more-->

项目中，设备基础信息中有个状态字段，类型是int型。由于设备信息是从别的平台上同步过来的，这个状态也需要同步。
为了保证状态的准确性，每次更新我都会根据是否在一定的时间范围内有采集数据，如果有，就认为是在线，如果没有，就更新成离线。

原本的更新就两个三个字段，状态、更新人、更新时间。今天看代码发现还需要更新最新的指标，就把Mybatis中的更新sql给扩展一下，一改出问题了

```
  <if test="item.status != null and item.status != ''">
        status = #{item.status},
 </if>

```

and后面的半段就是坑所在的位置。设备状态0代表正常，如果传0进行更新，and后面的代码会认为当前的status是‘’，不会进入更新逻辑。我写的是批量更新，造成的后果可想而知。

> 解决方案

```
  <if test="item.status != null">
        status = #{item.status},
  </if>
```
